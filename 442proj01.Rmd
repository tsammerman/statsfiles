---
title: "MAT442 - Project01"
author: "Titus S Ammerman"
date: "`r Sys.Date()`"
output:
  pdf_document:
    df_print: kable
  html_document: default
---

```{r setup, include=FALSE}
# don't forget to name and number tables
# MAYBE LIMIT THE size of figures here.
knitr::opts_chunk$set(echo = FALSE, fig.width=10,fig.height=11)
library(tidyverse)
library(car)
```


> For centuries, people looked at the full moon with some trepidation. From
stories of werewolves coming out, to more crime sprees, the full moon has
gotten the blame. Some researchers (I will send you the article later this
week) in the early 1970s set out to actually study whether there is a “fullmoon”
effect on the mental health of people. The researchers collected
admissions data for the emergency room at a mental health hospital for 12
months. They separated data into rates before the full moon (mean number
of patients seen 4 to 13 days before the full moon), during the full moon
(the number of patients seen on the full moon day), and after the full moon
(mean number of patients seen 4 to 13 days after the full moon). They also
kept track of which month the data came from since there was likely to be
a relationship between admissions and the season of the year. The data can
be found on D2L in the file MentalHealth.csv (also attached in the D2L
Submission folder). Analyze the data to answer the researchers’ question.

# Abstract

## Purpose

Questions to be addressed?

- Are hospital admissions associated with lunar phase?
- Are hospital admissions independent to lunar phase given seasonal differences?
  - Does the relationship between lunar phase and hospital admissions depend on the season?

## Background

 - Sample:
 - Population of interest:
 - Relevant variables: var1(category), var2(category)
 
# Exploratory Data Analysis

```{r}
# load dataset...

MentalHealth <- read_csv("MentalHealth.csv", show_col_types = FALSE)

# defining the month order
month_order <- c("Jan", "Feb", "Mar", "Apr", "May", "Jun", 
                 "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")
# defining the lunar order
moon_order <- c("Before", "During", "After")

# converting month and moon columns to factors with specified levels
MentalHealth <- MentalHealth %>%
  mutate(Moon = factor(Moon, levels = moon_order),
         Month = factor(Month, levels = month_order))

# summary statistics for overall sample

# ONLY DISPLAY THE FIRST FEW ROWS
MentalHealth

```

Now we will break this sample down according to `groups`, starting with...

```{r}
# grouping by lunar phase
ggplot(MentalHealth, aes(x = Moon, y = Admission, fill = Moon)) +
  geom_boxplot() +
  theme_minimal()

# grouping by month
ggplot(MentalHealth, aes(x = Month, y = Admission, fill = Month)) +
  geom_boxplot() +
  theme_minimal()
```

We will crease a `season` variable to observe trends that may be less apparent when viewing
admissions on a monthly basis:

```{r}
MentalHealth <- MentalHealth %>%
  mutate(Season = case_when(
    Month %in% c("Dec", "Jan", "Feb") ~ "Winter",
    Month %in% c("Mar", "Apr", "May") ~ "Spring",
    Month %in% c("Jun", "Jul", "Aug") ~ "Summer",
    Month %in% c("Sep", "Oct", "Nov") ~ "Fall"))

# grouping by season
ggplot(MentalHealth, aes(x = Season, y = Admission, fill = Season)) +
  geom_boxplot() +
  theme_minimal()
```
```{r}
# Sum admissions by Month and Moon Phase
#contingency_table1 <- xtabs(Admission ~ Month + Moon, data = MentalHealth)
contingency_table2 <- xtabs(Admission ~ Season + Moon, data = MentalHealth)

# Print the contingency table
#print(contingency_table1)
print(contingency_table2)

```
## Testing the Normality of the Distributions

We will start by observing the distribution of the seasons:
```{r}
# Load necessary library
#library(ggplot2)

# check number of observations per season
MentalHealth %>% group_by(Season) %>%  summarize("Observation Count" = n())

# Create histograms for each season
ggplot(MentalHealth, aes(x = Admission, fill = Season)) +
  geom_histogram(binwidth = 1, alpha = 0.7) +
  facet_wrap(~ Season) +
  labs(title = "Distribution of Admissions by Season",
       x = "Number of Admissions",
       y = "Frequency") +
  theme_minimal()

```

# Model Selection

A chi-squared test would work if the data were normally distributed.
A two-sample t-test allows for less stringent assumptions of normality.
A Kruskal-Wallis test...

```{r}
anova_model <- aov(Admission ~ Moon * Season, data = MentalHealth)
summary(anova_model)
anova_model2 <- aov(Admission ~ Moon + Season, data = MentalHealth)
summary(anova_model2)
```
According to the ANOVA table, the Season seems to have the greatest effect on admissions.

```{r}
# checking normality of residuals in anova
shapiro.test(residuals(anova_model))  # Shapiro-Wilk test

# checking homogeneity of variance
leveneTest(Admission ~ Moon * Season, data = MentalHealth)
```
The assumption of the normality of the residuals is met through the Shapiro-Wilk test.
The homogeneity assumption of the variance is met through the Levene test.
```{r}

TukeyHSD(anova_model)


```

Notable results:
 -Spring-Fall ($p = 0.0065914$)
 -Winter-Spring ($p = 0.0273852$)




```{r}
t.test(Admission ~ Moon, data = subset(MentalHealth, Moon %in% c("Before", "During")), var.equal = TRUE)
t.test(Admission ~ Season, data = subset(MentalHealth, Season %in% c("Fall", "Spring")), var.equal = TRUE)

```

## Model Assumptions


# Conclusion

We found that `season` was the most significant predictor of hospital admissions, with lunar phase failing to meet our significance threshold. More specifically, there seems to be a significant increase in admissions between the Fall and Spring months.

## Limitations

The study is limited by the relatively low sample size when considering the segmentation of the data that took place when placing it into a contingency table. A future study may aggregate data from multiple hospital locations, perhaps with varying climates, to see if the association with season and Admissions is spurious and simply a consequence of temperatures restraining activities and thus the potential for injury.